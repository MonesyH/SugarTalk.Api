
@section _scripts{
    <script>

        var userSessions = {};
        var server = new signalR.HubConnectionBuilder()
            .withUrl("/meetingHub" + location.search, {
               accessTokenFactory: () => "eyJhbGciOiJSUzI1NiIsImtpZCI6ImI2ZjhkNTVkYTUzNGVhOTFjYjJjYjAwZTFhZjRlOGUwY2RlY2E5M2QiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJhY2NvdW50cy5nb29nbGUuY29tIiwiYXpwIjoiNTQyNTU2MDMyMDM2LWxuMjJpZHRsMWM5OGNlYTdjazNyaGE1cGk4MmQxanR2LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwiYXVkIjoiNTQyNTU2MDMyMDM2LWxuMjJpZHRsMWM5OGNlYTdjazNyaGE1cGk4MmQxanR2LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTEwMzkxMDIxODYwOTMwNDc3MjYwIiwiZW1haWwiOiJ5YW1pbWVhbGRldkBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiYXRfaGFzaCI6IkV6Q1diQnZMcVE3OHg3VV9QWUZxYUEiLCJuYW1lIjoiRGV2IFlhbWltZWFsIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FBVFhBSnh2UGhVLXAyTFNySDhPeDNUenZmZmswMXNYb0lHLUdCRnBIcGl4PXM5Ni1jIiwiZ2l2ZW5fbmFtZSI6IkRldiIsImZhbWlseV9uYW1lIjoiWWFtaW1lYWwiLCJsb2NhbGUiOiJlbiIsImlhdCI6MTYyNTYxNjMwMiwiZXhwIjoxNjI1NjE5OTAyLCJqdGkiOiI2MjE1ZDAyMGQyNzY2NWM0Y2QyNDAxMjEzMzVmZmYyN2RkODMxMTI3In0.vJVJVpfGBskfuGvE_ocoryeAjtm8u1lAXWs4IDy0pCGzQ94Mytci89j2I-Bw7pe0iQFsnFeMiBfLh35Xz9CyuEb08xq0b9fXBMbyWzlKkWKDUpV4Y5sh77sjf7JmM3596V9H5pTFxubIZT3nmlNQNCfHJvZZUOXGRDZysC7mOfVvfg13jYmaYiHOWXTs0E1ucgGc9jL6x-um0-SY5MOPx_F32ue4M0wUMN7gp6OhLc9HIj-TAeiD_ImY5_6qgIvLOOBoav3k4LhO01FArhdZ3PTKoBwVlpv2v6VwQALIa0T_Fmg36g1zuRvkLsGa8MP9T0-ZVxjoKfK203mp-fYnCg"
            }).build();
        server.on("SetLocalUser", localUser => {
            userSessions[localUser.id] = new UserSession(localUser, true);
        });
        server.on("SetOtherUsers", otherUsers => {
            otherUsers.forEach(item => {
                userSessions[item.id] = new UserSession(item, false);
            });
        });
        server.on("OtherJoined", otherUser => {
            userSessions[otherUser.id] = new UserSession(otherUser, false);
        });
        server.on("ProcessAnswer", (id, answerSDP) => {
            userSessions[id].processAnswer(answerSDP);
        });
        server.on("AddCandidate", (id, candidate) => {
            userSessions[id].addCandidate(candidate);
        });
        server.on("OtherLeft", id => {
            let session = userSessions[id];
            if (session) {
                session.dispose();
                delete userSessions[id];
            }
        });
        server.start();
    </script>
}